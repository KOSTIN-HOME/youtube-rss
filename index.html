<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>YouTube RSS Viewer</title>

<style>
:root {
    --bg: #0f0f0f;
    --bg2: #181818;
    --text: #ffffff;
    --sub: #aaaaaa;
    --accent: #ff0000;
}

* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: Roboto, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
}

/* LAYOUT */
#app {
    display: flex;
    height: 100vh;
}

#player {
    flex: 1.6;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.player-wrapper {
    width: 100%;
    aspect-ratio: 16 / 9;
    background: #000;
    border-radius: 14px;
    overflow: hidden;
}

#videoInfo {
    font-size: 14px;
    color: var(--sub);
    min-height: 20px;
}

/* FEED */
#feedContainer {
    flex: 1;
    display: flex;
    flex-direction: column;
    border-left: 1px solid #222;
}

#tabs {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    padding: 12px;
    background: var(--bg2);
    border-bottom: 1px solid #222;
}

.tab {
    padding: 6px 12px;
    border-radius: 8px;
    cursor: pointer;
    background: #222;
    color: var(--sub);
    font-size: 14px;
    white-space: nowrap;
}

.tab.active {
    background: var(--accent);
    color: #fff;
}

#feed {
    flex: 1;
    overflow-y: auto;
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.video {
    display: flex;
    gap: 12px;
    padding: 10px;
    border-radius: 12px;
    cursor: pointer;
    background: var(--bg2);
    transition: background 0.2s;
}

.video:hover {
    background: #333;
}

.thumb {
    width: 168px;
    aspect-ratio: 16 / 9;
    border-radius: 10px;
    object-fit: cover;
}

.title {
    font-size: 15px;
    font-weight: 500;
}

.meta {
    font-size: 13px;
    color: var(--sub);
    margin-top: 6px;
}

#loader {
    padding: 20px;
    color: var(--sub);
    font-size: 14px;
}

/* ================= MOBILE ================= */

@media (max-width: 900px) {
    #app {
        flex-direction: column;
        height: auto;
    }

    #player {
        padding: 12px;
    }

    .player-wrapper {
        border-radius: 0;
    }

    #feedContainer {
        border-left: none;
        border-top: 1px solid #222;
    }

    .thumb {
        width: 120px;
    }
}
</style>
</head>

<body>

<div id="app">

    <div id="player">
        <div class="player-wrapper" id="playerWrapper"></div>
        <div id="videoInfo">Выберите видео</div>
    </div>

    <div id="feedContainer">
        <div id="tabs"></div>
        <div id="feed">
            <div id="loader">Подготовка…</div>
        </div>
    </div>

</div>

<script>
/* ================= CONFIG ================= */

const feeds = [
  { url: "https://www.youtube.com/feeds/videos.xml?channel_id=UCUzkWdUCkVrkKCcmut9epTQ", name: "Kuplinov ► Play" },
  { url: "https://www.youtube.com/feeds/videos.xml?channel_id=UCdKuE7a2QZeHPhDntXVZ91w", name: "DeadP47" },
  { url: "https://www.youtube.com/feeds/videos.xml?channel_id=UCUzkWdUCkVrkKCcmut9epTQ", name: "Rozetked" },
  { url: "https://www.youtube.com/feeds/videos.xml?channel_id=UCXvyU8oMwCmGOYYutgNwyiw", name: "Acting" },
  { url: "https://www.youtube.com/feeds/videos.xml?channel_id=UC_gKMJFeCf1bKzZr_fICkig", name: "TheDRZJ" },
  { url: "https://www.youtube.com/feeds/videos.xml?channel_id=UC2q4mHrzoR48mwSuAYtVPtQ", name: "Александр Панчин" },
  { url: "https://www.youtube.com/feeds/videos.xml?channel_id=UCgtAOyEQdAyjvm9ATCi_Aig", name: "AlexGyver" },
  { url: "https://www.youtube.com/feeds/videos.xml?channel_id=UC76KmU4gIQqVHZ3ESydElHA", name: "Черный Кумыс" },
  { url: "https://www.youtube.com/feeds/videos.xml?channel_id=UC-_iyv1-5NM5wmypELjz8Aw", name: "Максим Кузнецов" },
  { url: "https://www.youtube.com/feeds/videos.xml?channel_id=UC6uFoHcr_EEK6DgCS-LeTNA", name: "PRO Hi-Tech" },
  { url: "https://www.youtube.com/feeds/videos.xml?channel_id=UCHPwlUYfCZ1RzYNyZKvaRHw", name: "Portal News" },
  { url: "https://www.youtube.com/feeds/videos.xml?channel_id=UCI_OoGWEN7HHet11pNTFdJg", name: "Илья Геймер" },
  { url: "https://www.youtube.com/feeds/videos.xml?channel_id=UCsvsmFQ8eFRx5v6cdmuYBsg", name: "Restart" },
  { url: "https://www.youtube.com/feeds/videos.xml?channel_id=UCyPvbjMjnQBn-6FcxxovSHA", name: "Луцай" },
  { url: "https://www.youtube.com/feeds/videos.xml?channel_id=UCkrzQDo3U2GmHqqMjqYOuvA", name: "LoVisH Gaming Experience" }
];

const proxy = url =>
  `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;

const feedEl = document.getElementById("feed");
const loaderEl = document.getElementById("loader");
const playerWrapper = document.getElementById("playerWrapper");
const tabsEl = document.getElementById("tabs");
const videoInfoEl = document.getElementById("videoInfo");

const videoMap = new Map();
let currentTab = "Все видео";

init();

async function init() {
    loaderEl.textContent = `Загружаем каналы (0 / ${feeds.length})…`;

    await Promise.all(feeds.map(f => loadFeed(f)));

    renderTabs();
    renderFinal();
}

async function loadFeed(feed) {
    try {
        const res = await fetch(proxy(feed.url), { cache: "no-store" });
        const text = await res.text();
        parseFeed(text, feed.name);
    } catch (e) {
        console.warn("Ошибка загрузки:", feed.url);
    }
}

function parseFeed(text, channelName) {
    const xml = new DOMParser().parseFromString(text, "text/xml");

    xml.querySelectorAll("entry").forEach(e => {
        let id = e.querySelector("yt\\:videoId")?.textContent;

        if (!id) {
            const link = e.querySelector("link")?.getAttribute("href") || "";
            const match = link.match(/v=([^&]+)/);
            if (match) id = match[1];
        }

        if (!id || videoMap.has(id)) return;

        videoMap.set(id, {
            id,
            title: e.querySelector("title")?.textContent || "",
            channel: channelName,
            date: new Date(e.querySelector("published")?.textContent)
        });
    });
}

function renderTabs() {
    tabsEl.innerHTML = "";

    const allTab = createTab("Все видео");
    tabsEl.appendChild(allTab);

    feeds.forEach(f => {
        const tab = createTab(f.name);
        tabsEl.appendChild(tab);
    });
}

function createTab(name) {
    const el = document.createElement("div");
    el.className = "tab" + (name === currentTab ? " active" : "");
    el.textContent = name;
    el.onclick = () => {
        currentTab = name;
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        el.classList.add("active");
        renderFinal();
    };
    return el;
}

function renderFinal() {
    feedEl.innerHTML = "";
    loaderEl.textContent = "";

    const videos = [...videoMap.values()]
        .filter(v => currentTab === "Все видео" || v.channel === currentTab)
        .sort((a, b) => b.date - a.date);

    videos.forEach(renderVideo);
}

function renderVideo(v) {
    const div = document.createElement("div");
    div.className = "video";

    div.innerHTML = `
        <img class="thumb" src="https://i.ytimg.com/vi/${v.id}/hqdefault.jpg" onerror="this.src='https://via.placeholder.com/168x94/222/fff?text=Нет+обложки'">
        <div>
            <div class="title">${v.title}</div>
            <div class="meta">${v.channel} • ${v.date.toLocaleDateString("ru-RU")}</div>
        </div>
    `;

    div.onclick = () => loadVideo(v);
    feedEl.appendChild(div);
}

function loadVideo(v) {
    playerWrapper.innerHTML = `
        <iframe
            src="https://www.youtube.com/embed/${v.id}?autoplay=1&rel=0"
            allow="autoplay; encrypted-media; picture-in-picture"
            allowfullscreen
            style="width:100%;height:100%;border:none">
        </iframe>
    `;
    videoInfoEl.textContent = `${v.title} — ${v.channel}`;
}
</script>

</body>
</html>
