<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>YouTube RSS Viewer</title>

<style>
:root {
    --bg:#0f0f0f;
    --bg2:#181818;
    --text:#fff;
    --sub:#aaa;
    --accent:#ff0000;
}
*{box-sizing:border-box}
body{margin:0;font-family:Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
#app{display:flex;height:100vh}
#player{flex:1.6;padding:20px;display:flex;flex-direction:column;gap:10px}
.player-wrapper{width:100%;aspect-ratio:16/9;background:#000;border-radius:14px;overflow:hidden}
#videoInfo{font-size:14px;color:var(--sub);min-height:20px}
#feedContainer{flex:1;display:flex;flex-direction:column;border-left:1px solid #222}
#tabs{display:flex;gap:8px;flex-wrap:wrap;padding:12px;background:var(--bg2);border-bottom:1px solid #222}
.tab{padding:6px 12px;border-radius:8px;cursor:pointer;background:#222;color:var(--sub);font-size:14px;white-space:nowrap}
.tab.active{background:var(--accent);color:#fff}
.tab.loading::after{
    content:"";display:inline-block;margin-left:6px;width:12px;height:12px;
    border:2px solid var(--text);border-top-color:var(--accent);
    border-radius:50%;animation:spin .8s linear infinite
}
@keyframes spin{to{transform:rotate(360deg)}}

#retryFailed{
    display:none;
    margin:8px;
    padding:6px 10px;
    background:#222;
    color:#fff;
    border:1px solid #333;
    border-radius:8px;
    cursor:pointer;
}

#feed{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:10px}
.video{display:flex;gap:12px;padding:10px;border-radius:12px;cursor:pointer;background:var(--bg2)}
.video:hover{background:#333}
.thumb{width:168px;aspect-ratio:16/9;border-radius:10px;object-fit:cover}
.title{font-size:15px;font-weight:500}
.meta{font-size:13px;color:var(--sub);margin-top:6px}
#loader{padding:20px;color:var(--sub)}

@media (max-width: 768px) {
    #app {flex-direction: column;height:auto}
    #player {flex:none;padding:10px}
    #feedContainer {flex:none;border-left:none;border-top:1px solid #222}
    #feed {overflow-y:visible}
}
</style>
</head>

<body>

<!-- –ü—É–Ω–∫—Ç 1: –∑–∞—â–∏—Ç–∞ –ø–∞—Ä–æ–ª–µ–º -->
<div id="lockScreen" style="
    position:fixed;
    inset:0;
    background:#0f0f0f;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:9999;
">
    <div style="background:#181818;padding:20px;border-radius:12px;min-width:260px">
        <div style="margin-bottom:10px;color:#aaa">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</div>
        <input id="passwordInput" type="password" style="
            width:100%;
            padding:8px;
            border-radius:8px;
            border:1px solid #333;
            background:#000;
            color:#fff;
        ">
        <div id="passwordError" style="color:#f55;font-size:13px;margin-top:8px;display:none">
            –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å
        </div>
    </div>
</div>

<div id="app">
<div id="player">
    <div id="videoInfo">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ</div>
    <div class="player-wrapper" id="playerWrapper"></div>
</div>

<div id="feedContainer">
    <div id="tabs"></div>
    <button id="retryFailed">‚ü≥ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ</button>
    <div id="feed"><div id="loader">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞‚Ä¶</div></div>
</div>
</div>

<script>
const feeds=[
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCUzkWdUCkVrkKCcmut9epTQ",name:"DeadP47"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCdKuE7a2QZeHPhDntXVZ91w",name:"Kuplinov"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCDF_NIAEkcAUvzxe1DUzaQA",name:"Rozetked"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCXvyU8oMwCmGOYYutgNwyiw",name:"Acting"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC_gKMJFeCf1bKzZr_fICkig",name:"TheDRZJ"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC2q4mHrzoR48mwSuAYtVPtQ",name:"–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ü–∞–Ω—á–∏–Ω"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCgtAOyEQdAyjvm9ATCi_Aig",name:"AlexGyver"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC76KmU4gIQqVHZ3ESydElHA",name:"–ß–µ—Ä–Ω—ã–π –ö—É–º—ã—Å"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC-_iyv1-5NM5wmypELjz8Aw",name:"–ú–∞–∫—Å–∏–º –ö—É–∑–Ω–µ—Ü–æ–≤"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC6uFoHcr_EEK6DgCS-LeTNA",name:"PRO Hi-Tech"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCHPwlUYfCZ1RzYNyZKvaRHw",name:"Portal News"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCI_OoGWEN7HHet11pNTFdJg",name:"–ò–ª—å—è –ì–µ–π–º–µ—Ä"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCsvsmFQ8eFRx5v6cdmuYBsg",name:"Restart"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCyPvbjMjnQBn-6FcxxovSHA",name:"–õ—É—Ü–∞–π"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCkrzQDo3U2GmHqqMjqYOuvA",name:"LoVisH Gaming Experience"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCOw9Jzw3p4XzL5Ub5WglJRQ",name:"–ê–ª–µ–∫—Å–µ–π –ú–∞–∫–∞—Ä–µ–Ω–∫–æ–≤"}
];

const channelOrder = new Map(feeds.map((f,i)=>[f.name,i]));

const proxies=[
u=>`https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,
u=>`https://cors.isomorphic-git.org/${u}`,
u=>`https://thingproxy.freeboard.io/fetch/${u}`
];

async function proxyFetch(url){
    for(const p of proxies){
        try{
            const r=await fetch(p(url),{cache:"no-store"});
            if(r.ok) return r;
        }catch{}
    }
    throw new Error();
}

const tabsEl=document.getElementById("tabs");
const retryBtn=document.getElementById("retryFailed");
const feedEl=document.getElementById("feed");
const loaderEl=document.getElementById("loader");
const playerWrapper=document.getElementById("playerWrapper");
const videoInfoEl=document.getElementById("videoInfo");

const videoMap=new Map();
const channelStatus=new Map();

let currentTab="–í—Å–µ –≤–∏–¥–µ–æ";
const maxRetries=2;

init();

function init(){
    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ –∏–∑ localStorage
    const saved = localStorage.getItem("ytVideos");
    if(saved){
        JSON.parse(saved).forEach(v=>{
            v.date = new Date(v.date);
            videoMap.set(v.id,v);
        });
    }

    renderTabs();
    feeds.forEach(f=>channelStatus.set(f.name,"loading"));
    feeds.forEach(f=>loadFeedWithRetries(f,maxRetries));

    // –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö –≤–∏–¥–µ–æ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
    setInterval(checkNewVideos,10*60*1000);
}

async function loadFeedWithRetries(feed,retries){
    videoMap.delete(`__fail_${feed.name}`);

    const tab=document.querySelector(`.tab[data-channel="${feed.name}"]`);
    tab.classList.add("loading");

    try{
        const r=await proxyFetch(feed.url);
        const t=await r.text();
        parseFeed(t,feed.name);
        channelStatus.set(feed.name,"loaded");
    }catch{
        if(retries>0){
            setTimeout(()=>loadFeedWithRetries(feed,retries-1),1500);
            return;
        }
        // –ö–∞–Ω–∞–ª –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ failed
        channelStatus.set(feed.name,"failed");
        videoMap.set(`__fail_${feed.name}`,{
            empty:true,
            title:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞–Ω–∞–ª",
            channel:feed.name,
            date:new Date(0)
        });
        // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 1 –º–∏–Ω—É—Ç—ã –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        let start = Date.now();
        const retryInterval = setInterval(()=>{
            if(Date.now() - start > 60000) return clearInterval(retryInterval);
            loadFeedWithRetries(feed,maxRetries);
        },5000);
    }finally{
        tab.classList.remove("loading");
        finalizeTabs();
        renderVideosSorted();
    }
}

function checkNewVideos(){
    feeds.forEach(f=>loadFeedWithRetries(f,maxRetries));
}

function finalizeTabs(){
    const all=tabsEl.querySelector('[data-channel="–í—Å–µ –≤–∏–¥–µ–æ"]');
    const tabs=[...tabsEl.querySelectorAll(".tab")].filter(t=>t!==all);

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Ä—è–¥–æ–∫ –∫–∞–∫ –≤ feeds
    tabs.sort((a,b)=>{
        const ca=a.dataset.channel;
        const cb=b.dataset.channel;
        return channelOrder.get(ca)-channelOrder.get(cb);
    });

    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤–∫–ª–∞–¥–∫—É "–í—Å–µ –≤–∏–¥–µ–æ"
    tabsEl.innerHTML="";
    tabsEl.appendChild(all);

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–∞–∂–¥–æ–π –≤–∫–ª–∞–¥–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–Ω–∞–ª–∞
    tabs.forEach(t=>{
        const name = t.dataset.channel;
        const status = channelStatus.get(name); // loading / loaded / failed
        let statusIcon = "";
        if(status==="loading") statusIcon = " üîÑ";
        else if(status==="loaded") statusIcon = " ‚úÖ";
        else if(status==="failed") statusIcon = " ‚ùå";

        t.textContent = name + statusIcon;
        tabsEl.appendChild(t);
    });

    // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å failed
    retryBtn.style.display=[...channelStatus.values()].includes("failed")?"block":"none";
}

retryBtn.onclick=()=>{
    feeds.forEach(f=>{
        if(channelStatus.get(f.name)==="failed"){
            channelStatus.set(f.name,"loading");
            loadFeedWithRetries(f,maxRetries);
        }
    });
    retryBtn.style.display="none";
};

function renderTabs(){
    tabsEl.innerHTML="";
    tabsEl.appendChild(createTab("–í—Å–µ –≤–∏–¥–µ–æ"));
    feeds.forEach(f=>tabsEl.appendChild(createTab(f.name)));
}

function createTab(name){
    const t=document.createElement("div");
    t.className="tab"+(name===currentTab?" active":"");
    t.dataset.channel=name;
    t.textContent=name;
    t.onclick=()=>{
        currentTab=name;
        document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
        t.classList.add("active");
        renderVideosSorted();
    };
    return t;
}

function parseFeed(text,channel){
    const xml=new DOMParser().parseFromString(text,"text/xml");
    xml.querySelectorAll("entry").forEach(e=>{
        let id=e.querySelector("yt\\:videoId")?.textContent;
        if(!id){
            const link=e.querySelector("link")?.getAttribute("href")||"";
            const m=link.match(/v=([^&]+)/);
            if(m) id=m[1];
        }
        if(!id||videoMap.has(id)) return;

        const video={
            id,
            title:e.querySelector("title")?.textContent||"",
            channel,
            date:new Date(e.querySelector("published")?.textContent)
        };
        videoMap.set(id,video);
    });

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –≤–∏–¥–µ–æ –≤ localStorage –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–Ω–∞–ª–∞
    localStorage.setItem("ytVideos",JSON.stringify([...videoMap.values()]));
}

function renderVideosSorted(){
    feedEl.innerHTML=""; // —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –æ—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥ —Ä–µ–Ω–¥–µ—Ä–æ–º
    let hasVideos = [...videoMap.values()]
        .filter(v=>currentTab==="–í—Å–µ –≤–∏–¥–µ–æ"||v.channel===currentTab)
        .length > 0;

    // –ï—Å–ª–∏ –≤–∏–¥–µ–æ –µ—Å—Ç—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º ‚úÖ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ "–ó–∞–≥—Ä—É–∂–µ–Ω–æ"
    if(hasVideos){
        loaderEl.textContent = "‚úÖ –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã";
    } else {
        loaderEl.textContent = "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞‚Ä¶";
    }

    [...videoMap.values()]
        .filter(v=>currentTab==="–í—Å–µ –≤–∏–¥–µ–æ"||v.channel===currentTab)
        .sort((a,b)=>b.date-a.date)
        .forEach(v=>{
            const d=document.createElement("div");
            d.className="video";
            if(v.empty){
                d.innerHTML=`<div style="color:#f55">${v.title} (${v.channel})</div>`;
            }else{
                d.innerHTML=`
                <img class="thumb" src="https://i.ytimg.com/vi/${v.id}/hqdefault.jpg">
                <div>
                    <div class="title">${v.title}</div>
                    <div class="meta">
                        ${v.channel} ‚Ä¢ ${v.date.toLocaleDateString("ru-RU")}
                    </div>
                </div>`;
                d.onclick=()=>loadVideo(v);
            }
            feedEl.appendChild(d);
        });
}


function loadVideo(v){
    playerWrapper.innerHTML=`
    <iframe src="https://www.youtube.com/embed/${v.id}?playsinline=1"
    allow="autoplay" allowfullscreen style="width:100%;height:100%;border:none"></iframe>`;
    videoInfoEl.textContent=`${v.title} ‚Äî ${v.channel}`;
}

/* –ø–∞—Ä–æ–ª—å */
const lockScreen=document.getElementById("lockScreen");
const passwordInput=document.getElementById("passwordInput");
const passwordError=document.getElementById("passwordError");

passwordInput.addEventListener("keydown",e=>{
    if(e.key==="Enter"){
        if(passwordInput.value==="672318"){
            lockScreen.remove();
        }else{
            passwordError.style.display="block";
            passwordInput.value="";
        }
    }
});
</script>
</body>
</html>


