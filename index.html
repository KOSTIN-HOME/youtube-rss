<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>YouTube RSS Viewer</title>

<style>
:root{--bg:#0f0f0f;--bg2:#181818;--text:#fff;--sub:#aaa;--accent:#ff0000}
*{box-sizing:border-box}
body{margin:0;font-family:Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
#app{display:none;flex;height:100vh}
#player{flex:1.6;padding:20px;display:flex;flex-direction:column;gap:10px}
.player-wrapper{width:100%;aspect-ratio:16/9;background:#000;border-radius:14px;overflow:hidden}
#videoInfo{font-size:14px;color:var(--sub);min-height:20px}
#feedContainer{flex:1;display:flex;flex-direction:column;border-left:1px solid #222}
#tabs{display:flex;gap:8px;flex-wrap:wrap;padding:12px;background:var(--bg2);border-bottom:1px solid #222}
.tab{padding:6px 12px;border-radius:8px;cursor:pointer;background:#222;color:var(--sub);font-size:14px;white-space:nowrap}
.tab.active{background:var(--accent);color:#fff}
.tab.loading::after{content:"";display:inline-block;margin-left:6px;width:12px;height:12px;border:2px solid var(--text);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
#retryFailed{display:none;margin:8px;padding:6px 10px;background:#222;color:#fff;border:1px solid #333;border-radius:8px;cursor:pointer}
#feed{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:10px}
.video{display:flex;gap:12px;padding:10px;border-radius:12px;cursor:pointer;background:var(--bg2)}
.video:hover{background:#333}
.thumb{width:168px;aspect-ratio:16/9;border-radius:10px;object-fit:cover}
.title{font-size:15px;font-weight:500}
.meta{font-size:13px;color:var(--sub);margin-top:6px}
.date{font-size:12px;color:#888;margin-top:2px}
#loader{padding:20px;color:var(--sub)}
@media (max-width:768px){
#app{flex-direction:column;height:auto}
#player{padding:10px}
#feedContainer{border-left:none;border-top:1px solid #222}
}
</style>
</head>

<body>

<div id="lock" style="position:fixed;inset:0;background:#0f0f0f;display:flex;align-items:center;justify-content:center;z-index:9999">
<div style="background:#181818;padding:20px;border-radius:12px;min-width:260px">
<input id="pwd" type="password" placeholder="Пароль" style="width:100%;padding:8px;border-radius:8px;border:none;margin-bottom:10px">
<button id="btn" style="width:100%;padding:8px;border-radius:8px;border:none;background:#ff0000;color:#fff">Войти</button>
<div id="err" style="color:#f55;font-size:13px;margin-top:8px;display:none">Неверный пароль</div>
</div>
</div>

<div id="app">
<div id="player">
<div id="videoInfo">Выберите видео</div>
<div class="player-wrapper" id="playerWrapper"></div>
</div>
<div id="feedContainer">
<div id="tabs"></div>
<button id="retryFailed">⟳ Перезагрузить незагруженные</button>
<div id="feed"><div id="loader">Загрузка…</div></div>
</div>
</div>

<script>
if(window.top!==window.self)document.body.innerHTML=""
if(/view-source|inspect|devtools/i.test(navigator.userAgent))document.body.innerHTML=""

const PASS_HASH="346058ad3f947af4bd7c1dbe70ed1c155eafc95d856c9e781b25e871f0b736e6"
async function sha256(t){const b=new TextEncoder().encode(t);const h=await crypto.subtle.digest("SHA-256",b);return[...new Uint8Array(h)].map(x=>x.toString(16).padStart(2,"0")).join("")}

document.getElementById("btn").onclick=async()=>{
if(await sha256(document.getElementById("pwd").value)===PASS_HASH){
document.getElementById("lock").remove()
document.getElementById("app").style.display="flex"
init()
}else document.getElementById("err").style.display="block"
}

const feeds=[
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCUzkWdUCkVrkKCcmut9epTQ",name:"DeadP47"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCdKuE7a2QZeHPhDntXVZ91w",name:"Kuplinov"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCDF_NIAEkcAUvzxe1DUzaQA",name:"Rozetked"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCXvyU8oMwCmGOYYutgNwyiw",name:"Acting"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC_gKMJFeCf1bKzZr_fICkig",name:"TheDRZJ"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC2q4mHrzoR48mwSuAYtVPtQ",name:"Александр Панчин"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCgtAOyEQdAyjvm9ATCi_Aig",name:"AlexGyver"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC76KmU4gIQqVHZ3ESydElHA",name:"Черный Кумыс"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC-_iyv1-5NM5wmypELjz8Aw",name:"Максим Кузнецов"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC6uFoHcr_EEK6DgCS-LeTNA",name:"PRO Hi-Tech"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCHPwlUYfCZ1RzYNyZKvaRHw",name:"Portal News"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCI_OoGWEN7HHet11pNTFdJg",name:"Илья Геймер"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCsvsmFQ8eFRx5v6cdmuYBsg",name:"Restart"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCyPvbjMjnQBn-6FcxxovSHA",name:"Луцай"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCkrzQDo3U2GmHqqMjqYOuvA",name:"LoVisH Gaming Experience"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCOw9Jzw3p4XzL5Ub5WglJRQ",name:"Алексей Макаренков"}
]

const proxies=[u=>`https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,u=>`https://cors.isomorphic-git.org/${u}`,u=>`https://thingproxy.freeboard.io/fetch/${u}`]

async function proxyFetch(url){for(const p of proxies){try{const r=await fetch(p(url),{cache:"no-store"});if(r.ok)return r}catch{}}throw""}

const tabsEl=document.getElementById("tabs")
const retryBtn=document.getElementById("retryFailed")
const feedEl=document.getElementById("feed")
const playerWrapper=document.getElementById("playerWrapper")
const videoInfoEl=document.getElementById("videoInfo")

const videoMap=new Map(JSON.parse(localStorage.getItem("videos")||"[]"))
const channelStatus=new Map()

let currentTab="Все видео"
const maxRetries=2

function init(){
renderTabs()
renderVideosSorted()
feeds.forEach(f=>channelStatus.set(f.name,"loading"))
feeds.forEach(f=>loadFeedWithRetries(f,maxRetries))
setInterval(()=>feeds.forEach(f=>loadFeedWithRetries(f,0)),600000)
}

function saveCache(){localStorage.setItem("videos",JSON.stringify([...videoMap]))}

async function loadFeedWithRetries(feed,retries){
const tab=document.querySelector(`.tab[data-channel="${feed.name}"]`)
tab.classList.add("loading")
try{
const r=await proxyFetch(feed.url)
parseFeed(await r.text(),feed.name)
channelStatus.set(feed.name,"loaded")
}catch{
if(retries>0){setTimeout(()=>loadFeedWithRetries(feed,retries-1),1500);return}
channelStatus.set(feed.name,"failed")
}catch{}finally{
tab.classList.remove("loading")
finalizeTabs()
renderVideosSorted()
saveCache()
}
}

function parseFeed(text,channel){
const xml=new DOMParser().parseFromString(text,"text/xml")
xml.querySelectorAll("entry").forEach(e=>{
const id=e.querySelector("yt\\:videoId")?.textContent
if(!id||videoMap.has(id))return
videoMap.set(id,{
id,
title:e.querySelector("title")?.textContent||"",
channel,
date:new Date(e.querySelector("published")?.textContent)
})
})
}

function renderTabs(){
tabsEl.innerHTML=""
tabsEl.appendChild(createTab("Все видео"))
feeds.forEach(f=>tabsEl.appendChild(createTab(f.name)))
}

function createTab(name){
const t=document.createElement("div")
t.className="tab"+(name===currentTab?" active":"")
t.dataset.channel=name
t.textContent=name
t.onclick=()=>{currentTab=name;document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));t.classList.add("active");renderVideosSorted()}
return t
}

function finalizeTabs(){
const all=tabsEl.querySelector('[data-channel="Все видео"]')
const tabs=[...tabsEl.querySelectorAll(".tab")].filter(t=>t!==all)
tabs.sort((a,b)=>{
const sa=channelStatus.get(a.dataset.channel)
const sb=channelStatus.get(b.dataset.channel)
if(sa===sb)return feeds.findIndex(f=>f.name===a.dataset.channel)-feeds.findIndex(f=>f.name===b.dataset.channel)
if(sa==="loaded")return-1
if(sb==="loaded")return 1
return sa==="failed"?1:-1
})
tabsEl.innerHTML=""
tabsEl.appendChild(all)
tabs.forEach(t=>tabsEl.appendChild(t))
retryBtn.style.display=[...channelStatus.values()].includes("failed")?"block":"none"
}

retryBtn.onclick=()=>feeds.forEach(f=>channelStatus.get(f.name)==="failed"&&loadFeedWithRetries(f,maxRetries))

function renderVideosSorted(){
feedEl.innerHTML=""
;[...videoMap.values()]
.filter(v=>currentTab==="Все видео"||v.channel===currentTab)
.sort((a,b)=>b.date-a.date)
.forEach(v=>{
const d=document.createElement("div")
d.className="video"
d.innerHTML=`
<img class="thumb" loading="lazy" src="https://i.ytimg.com/vi/${v.id}/hqdefault.jpg">
<div>
<div class="title">${v.title}</div>
<div class="meta">${v.channel}</div>
<div class="date">${v.date.toLocaleDateString()}</div>
</div>`
d.onclick=()=>loadVideo(v)
feedEl.appendChild(d)
})
}

function loadVideo(v){
playerWrapper.innerHTML=`<iframe src="https://www.youtube.com/embed/${v.id}?playsinline=1&rel=0" allowfullscreen style="width:100%;height:100%;border:none"></iframe>`
videoInfoEl.textContent=`${v.title} — ${v.channel}`
}
</script>
</body>
</html>
