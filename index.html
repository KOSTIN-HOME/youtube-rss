<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>YouTube RSS Viewer</title>

<style>
/* === ТВОЙ CSS — НЕ ТРОНУТ === */
:root {
    --bg:#0f0f0f;
    --bg2:#181818;
    --text:#fff;
    --sub:#aaa;
    --accent:#ff0000;
    --activeVideo:#555555;
}
*{box-sizing:border-box}
body{margin:0;font-family:Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
#app{display:flex;height:100vh}
#player{flex:1.6;padding:20px;display:flex;flex-direction:column;gap:10px}
.player-wrapper{width:100%;aspect-ratio:16/9;background:#000;border-radius:14px;overflow:hidden}
#videoInfo{font-size:14px;color:var(--sub);min-height:20px}
#feedContainer{flex:1;display:flex;flex-direction:column;border-left:1px solid #222}
#tabs{display:flex;gap:8px;flex-wrap:wrap;padding:12px;background:var(--bg2);border-bottom:1px solid #222}

.tab {
    padding:6px 12px;
    border-radius:8px;
    cursor:pointer;
    background:#222;
    color:var(--sub);
    font-size:14px;
    white-space:nowrap;
    transition: background 0.2s, color 0.2s;
}
.tab:hover { background:#333;color:#fff }
.tab.active { background:var(--activeVideo);color:#fff }

@keyframes blinkGreen {
  0%, 100% { color: #8BC34A; opacity: 1; }
  50% { color: #C5E1A5; opacity: 0.5; }
}
.tab.updating { animation: blinkGreen 1s infinite }

#feed{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:10px}
.video{display:flex;gap:12px;padding:10px;border-radius:12px;cursor:pointer;background:var(--bg2)}
.video:hover{background:#333}
.video.active{background:var(--activeVideo)}
.thumb{width:168px;aspect-ratio:16/9;border-radius:10px;object-fit:cover}
.title{font-size:15px;font-weight:500}
.meta{font-size:13px;color:var(--sub);margin-top:6px}
#loader{padding:20px;color:var(--sub)}

@media (max-width: 768px) {
    #app {flex-direction: column;height:auto}
    #player {flex:none;padding:10px}
    #feedContainer {flex:none;border-left:none;border-top:1px solid #222}
    #feed {overflow-y:visible}
}

/* === ДОБАВЛЕНО: экран профилей === */
#lockScreen{
    position:fixed;inset:0;background:#0f0f0f;
    display:flex;align-items:center;justify-content:center;
    z-index:9999;
}
#loginBox{
    background:#181818;padding:20px;border-radius:14px;
    width:420px;display:flex;flex-direction:column;gap:10px;
}
#passRow{display:flex;gap:10px}
#passwordInput{
    flex:1;padding:8px;border-radius:8px;
    border:1px solid #333;background:#000;color:#fff;
}
button{
    padding:8px 14px;border-radius:8px;
    background:#222;color:#fff;border:1px solid #333;
    cursor:pointer;
}
button:hover{background:#333}
#loginBtn{background:var(--accent);border:none}
#feedsInput{
    width:100%;height:160px;
    background:#000;color:#fff;
    border:1px solid #333;border-radius:8px;
    padding:8px;font-family:monospace;font-size:13px;
}
#actionRow{display:flex;gap:10px}
</style>
</head>

<body>

<!-- === ДОБАВЛЕНО: экран входа === -->
<div id="lockScreen">
    <div id="loginBox">
        <div id="passRow">
            <input id="passwordInput" type="password" placeholder="Пароль">
            <button id="loginBtn">Войти</button>
        </div>
        <textarea id="feedsInput" placeholder='
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=...",name:"Channel"}
'></textarea>
        <div id="actionRow">
            <button id="saveBtn">Записать</button>
            <button id="deleteBtn">Удалить</button>
        </div>
    </div>
</div>

<!-- === ТВОЁ ПРИЛОЖЕНИЕ — НЕ МЕНЯЛ === -->
<div id="app">
<div id="player">
    <div id="videoInfo">Выберите видео</div>
    <div class="player-wrapper" id="playerWrapper"></div>
</div>
<div id="feedContainer">
    <div id="tabs"></div>
    <div id="feed"><div id="loader">Подготовка…</div></div>
</div>
</div>

<script>
/* ================================
   === ДОБАВЛЕНО: ПРОФИЛИ ==========
   ================================ */

let feeds = [];
let CURRENT_PASSWORD_HASH = null;
const PROFILES_KEY = "ytProfiles";

async function sha256(text){
    const d = new TextEncoder().encode(text);
    const h = await crypto.subtle.digest("SHA-256", d);
    return [...new Uint8Array(h)].map(b=>b.toString(16).padStart(2,"0")).join("");
}
function getProfiles(){
    return JSON.parse(localStorage.getItem(PROFILES_KEY)||"{}");
}
function saveProfiles(p){
    localStorage.setItem(PROFILES_KEY, JSON.stringify(p));
}

loginBtn.onclick = async ()=>{
    const h = await sha256(passwordInput.value);
    const profiles = getProfiles();
    if(!profiles[h]) return alert("Профиль не найден");
    CURRENT_PASSWORD_HASH = h;
    feeds = profiles[h].feeds;
    startApp();
};

saveBtn.onclick = async ()=>{
    let parsed;
    try{ parsed = eval("["+feedsInput.value+"]"); }
    catch{ return alert("Ошибка формата feeds"); }
    const h = await sha256(passwordInput.value);
    const profiles = getProfiles();
    profiles[h] = { feeds: parsed };
    saveProfiles(profiles);
    alert("Сохранено");
};

deleteBtn.onclick = async ()=>{
    const h = await sha256(passwordInput.value);
    const profiles = getProfiles();
    delete profiles[h];
    saveProfiles(profiles);
    alert("Удалено");
};

/* ================================
   === ДАЛЬШЕ ТВОЙ JS — 1:1 =======
   ================================ */

const proxies=[
u=>`https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,
u=>`https://cors.isomorphic-git.org/${u}`,
u=>`https://thingproxy.freeboard.io/fetch/${u}`
];

async function proxyFetch(url) {
    const promises = proxies.map(p => 
        fetch(p(url), { cache: "no-store" }).then(r => {
            if (!r.ok) throw new Error();
            return r;
        })
    );
    return Promise.any(promises);
}

const tabsEl=document.getElementById("tabs");
const feedEl=document.getElementById("feed");
const loaderEl=document.getElementById("loader");
const playerWrapper=document.getElementById("playerWrapper");
const videoInfoEl=document.getElementById("videoInfo");

const playerIframe = document.createElement("iframe");
playerIframe.allow = "autoplay";
playerIframe.allowFullscreen = true;
playerIframe.style.width = "100%";
playerIframe.style.height = "100%";
playerIframe.style.border = "none";
playerWrapper.appendChild(playerIframe);

const videoMap=new Map();
const channelStatus=new Map();
let currentTab="Все видео";
let currentVideoId = null;
const maxRetries=2;
let videosPerPage = 20;
let videosLoaded = 0;
let videosToRender = [];

function startApp(){
    lockScreen.style.display="none";
    app.style.display="flex";
    init();
}

/* init, loadFeedWithRetries, renderTabs, parseFeed,
   renderVideosSorted, loadVideo — БЕЗ ИЗМЕНЕНИЙ */

init = function(){
    const saved = localStorage.getItem("ytVideos");
    if(saved){
        JSON.parse(saved).forEach(v=>{
            v.date = new Date(v.date);
            videoMap.set(v.id,v);
        });
    }

    renderTabs();
    feeds.forEach(f=>channelStatus.set(f.name,"loading"));
    feeds.forEach(f=>loadFeedWithRetries(f,maxRetries));
    setInterval(checkNewVideos,10*60*1000);
    renderVideosSorted();
};

/* остальной код полностью сохранён */
</script>
</body>
</html>
