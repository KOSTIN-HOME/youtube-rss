<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YouTube RSS Viewer</title>

<style>
:root{
    --bg:#0f0f0f;
    --bg2:#181818;
    --text:#fff;
    --sub:#aaa;
    --accent:#ff0000;
}
*{box-sizing:border-box}
body{margin:0;font-family:Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
#app{display:flex;height:100vh}
#player{flex:1.6;padding:20px;display:flex;flex-direction:column;gap:10px}
.player-wrapper{width:100%;aspect-ratio:16/9;background:#000;border-radius:14px;overflow:hidden}
#videoInfo{font-size:14px;color:var(--sub)}
#feedContainer{flex:1;display:flex;flex-direction:column;border-left:1px solid #222}
#tabs{display:flex;gap:8px;flex-wrap:wrap;padding:12px;background:var(--bg2)}
.tab{padding:6px 12px;border-radius:8px;cursor:pointer;background:#222;color:var(--sub)}
.tab.active{background:var(--accent);color:#fff}
#feed{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:10px}
.video{display:flex;gap:12px;padding:10px;border-radius:12px;cursor:pointer;background:var(--bg2)}
.video:hover{background:#333}
.thumb{width:168px;aspect-ratio:16/9;border-radius:10px}
.meta{font-size:13px;color:var(--sub);margin-top:6px}
#loader{padding:20px;color:var(--sub)}
</style>
</head>

<body>

<div id="lockScreen" style="position:fixed;inset:0;background:#0f0f0f;display:flex;align-items:center;justify-content:center;z-index:9999">
    <div style="background:#181818;padding:20px;border-radius:12px;min-width:260px">
        <div style="margin-bottom:10px;color:#aaa">Введите пароль</div>
        <input id="passwordInput" type="password" style="width:100%;padding:8px;border-radius:8px;background:#000;color:#fff">
        <div id="passwordError" style="color:#f55;font-size:13px;margin-top:8px;display:none">Неверный пароль</div>
    </div>
</div>

<div id="app" style="display:none">
<div id="player">
    <div id="videoInfo">Выберите видео</div>
    <div class="player-wrapper" id="playerWrapper"></div>
</div>
<div id="feedContainer">
    <div id="tabs"></div>
    <div id="feed"><div id="loader">Загрузка…</div></div>
</div>
</div>

<script>
if(self!==top||location.protocol==="file:"){document.body.innerHTML=""}

const PASSWORD_HASH="03ac674216f3e15c761ee1a5e255f067953623c8b388b4459e13f978d7c846f4"

async function sha256(t){
    const b=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(t))
    return [...new Uint8Array(b)].map(x=>x.toString(16).padStart(2,"0")).join("")
}

passwordInput.onkeydown=async e=>{
    if(e.key==="Enter"){
        const h=await sha256(passwordInput.value)
        if(h===PASSWORD_HASH){
            lockScreen.remove()
            app.style.display="flex"
            init()
        }else{
            passwordError.style.display="block"
            passwordInput.value=""
        }
    }
}

const feeds=[
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCUzkWdUCkVrkKCcmut9epTQ",name:"DeadP47"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCdKuE7a2QZeHPhDntXVZ91w",name:"Kuplinov"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCDF_NIAEkcAUvzxe1DUzaQA",name:"Rozetked"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCXvyU8oMwCmGOYYutgNwyiw",name:"Acting"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC_gKMJFeCf1bKzZr_fICkig",name:"TheDRZJ"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC2q4mHrzoR48mwSuAYtVPtQ",name:"Александр Панчин"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCgtAOyEQdAyjvm9ATCi_Aig",name:"AlexGyver"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC76KmU4gIQqVHZ3ESydElHA",name:"Черный Кумыс"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC-_iyv1-5NM5wmypELjz8Aw",name:"Максим Кузнецов"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC6uFoHcr_EEK6DgCS-LeTNA",name:"PRO Hi-Tech"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCHPwlUYfCZ1RzYNyZKvaRHw",name:"Portal News"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCI_OoGWEN7HHet11pNTFdJg",name:"Илья Геймер"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCsvsmFQ8eFRx5v6cdmuYBsg",name:"Restart"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCyPvbjMjnQBn-6FcxxovSHA",name:"Луцай"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCkrzQDo3U2GmHqqMjqYOuvA",name:"LoVisH Gaming Experience"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCOw9Jzw3p4XzL5Ub5WglJRQ",name:"Алексей Макаренков"}
]

const proxies=[u=>`https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`]

const videoMap=new Map(JSON.parse(localStorage.getItem("videos")||"[]"))

function init(){
    renderTabs()
    render()
    loadAll()
    setInterval(loadAll,600000)
}

async function loadAll(){
    loader.textContent="Обновление каналов…"
    for(const f of feeds){
        try{
            const r=await fetch(proxies[0](f.url),{cache:"no-store"})
            const t=await r.text()
            parseFeed(t,f.name)
        }catch{}
    }
    save()
    render()
    loader.textContent=""
}

function parseFeed(text,channel){
    const xml=new DOMParser().parseFromString(text,"text/xml")
    xml.querySelectorAll("entry").forEach(e=>{
        const id=e.querySelector("yt\\:videoId")?.textContent
        if(!id||videoMap.has(id))return
        videoMap.set(id,{
            id,
            title:e.querySelector("title")?.textContent||"",
            channel,
            date:new Date(e.querySelector("published")?.textContent)
        })
    })
}

function save(){
    localStorage.setItem("videos",JSON.stringify([...videoMap]))
}

function renderTabs(){
    tabs.innerHTML=""
    const all=document.createElement("div")
    all.className="tab active"
    all.textContent="Все видео"
    all.onclick=()=>{
        document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"))
        all.classList.add("active")
        render()
    }
    tabs.appendChild(all)
}

function render(){
    feed.innerHTML=""
    [...videoMap.values()]
        .sort((a,b)=>b.date-a.date)
        .forEach(v=>{
            const d=document.createElement("div")
            d.className="video"
            d.innerHTML=`
                <img class="thumb" loading="lazy" src="https://i.ytimg.com/vi/${v.id}/hqdefault.jpg">
                <div>
                    <div>${v.title}</div>
                    <div class="meta">${v.channel} • ${v.date.toLocaleDateString("ru-RU")}</div>
                </div>`
            d.onclick=()=>{
                playerWrapper.innerHTML=`<iframe src="https://www.youtube.com/embed/${v.id}?playsinline=1" style="width:100%;height:100%;border:0"></iframe>`
                videoInfo.textContent=`${v.title} — ${v.channel}`
            }
            feed.appendChild(d)
        })
}
</script>
</body>
</html>
