<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YouTube RSS Viewer</title>

<style>
:root{
    --bg:#0f0f0f;
    --bg2:#181818;
    --bg3:#2a2a2a;
    --text:#fff;
    --sub:#aaa;
}
*{box-sizing:border-box}
body{margin:0;font-family:Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
#app{display:flex;height:100vh}

#player{flex:1.6;padding:20px;display:flex;flex-direction:column;gap:10px}
.player-wrapper{width:100%;aspect-ratio:16/9;background:#000;border-radius:14px;overflow:hidden}
#videoInfo{font-size:14px;color:var(--sub)}

#feedContainer{flex:1;display:flex;flex-direction:column;border-left:1px solid #222}
#tabs{display:flex;gap:8px;flex-wrap:wrap;padding:12px;background:var(--bg2);border-bottom:1px solid #222}
.tab{padding:6px 12px;border-radius:8px;cursor:pointer;background:#222;color:#aaa}
.tab.active{background:#555;color:#fff}

#feed{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:10px}
.video{display:flex;gap:12px;padding:10px;border-radius:12px;cursor:pointer;background:var(--bg2)}
.video:hover{background:#333}
.video.active{
    background:var(--bg3);
    outline:1px solid #666;
}

.thumb{width:168px;aspect-ratio:16/9;border-radius:10px;object-fit:cover}
.title{font-size:15px;font-weight:500}
.meta{font-size:13px;color:var(--sub)}

#loader{padding:20px;color:var(--sub)}

@media(max-width:768px){
    #app{flex-direction:column}
    #feedContainer{border-left:none;border-top:1px solid #222}
}
</style>
</head>

<body>

<!-- ðŸ”’ Lock screen -->
<div id="lockScreen" style="
position:fixed;inset:0;background:#0f0f0f;
display:flex;align-items:center;justify-content:center;z-index:9999;">
    <div style="background:#181818;padding:20px;border-radius:12px;min-width:260px">
        <div style="margin-bottom:10px;color:#aaa">Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ</div>
        <input id="passwordInput" type="password" style="
            width:100%;padding:8px;border-radius:8px;
            border:1px solid #333;background:#000;color:#fff">
    </div>
</div>

<div id="app">
<div id="player">
    <div id="videoInfo">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð²Ð¸Ð´ÐµÐ¾</div>
    <div class="player-wrapper" id="playerWrapper"></div>
</div>

<div id="feedContainer">
    <div id="tabs"></div>
    <div id="feed"><div id="loader">Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°â€¦</div></div>
</div>
</div>

<script>
/* ===== Ð¿Ð°Ñ€Ð¾Ð»ÑŒ ===== */
const PASSWORD_HASH="346058ad3f947af4bd7c1dbe70ed1c155eafc95d856c9e781b25e871f0b736e6";
const lockScreen=document.getElementById("lockScreen");
const passwordInput=document.getElementById("passwordInput");

async function sha256(t){
    const b=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(t));
    return [...new Uint8Array(b)].map(x=>x.toString(16).padStart(2,"0")).join("");
}
passwordInput.addEventListener("input",async()=>{
    if(await sha256(passwordInput.value)===PASSWORD_HASH){
        lockScreen.style.display="none";
    }
});

/* ===== Ð´Ð°Ð½Ð½Ñ‹Ðµ ===== */
const feeds=[
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCUzkWdUCkVrkKCcmut9epTQ",name:"DeadP47"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCdKuE7a2QZeHPhDntXVZ91w",name:"Kuplinov"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCDF_NIAEkcAUvzxe1DUzaQA",name:"Rozetked"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCXvyU8oMwCmGOYYutgNwyiw",name:"Acting"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC_gKMJFeCf1bKzZr_fICkig",name:"TheDRZJ"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC2q4mHrzoR48mwSuAYtVPtQ",name:"ÐÐ»ÐµÐºÑÐ°Ð½Ð´Ñ€ ÐŸÐ°Ð½Ñ‡Ð¸Ð½"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCgtAOyEQdAyjvm9ATCi_Aig",name:"AlexGyver"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC76KmU4gIQqVHZ3ESydElHA",name:"Ð§ÐµÑ€Ð½Ñ‹Ð¹ ÐšÑƒÐ¼Ñ‹Ñ"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC-_iyv1-5NM5wmypELjz8Aw",name:"ÐœÐ°ÐºÑÐ¸Ð¼ ÐšÑƒÐ·Ð½ÐµÑ†Ð¾Ð²"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UC6uFoHcr_EEK6DgCS-LeTNA",name:"PRO Hi-Tech"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCHPwlUYfCZ1RzYNyZKvaRHw",name:"Portal News"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCI_OoGWEN7HHet11pNTFdJg",name:"Ð˜Ð»ÑŒÑ Ð“ÐµÐ¹Ð¼ÐµÑ€"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCsvsmFQ8eFRx5v6cdmuYBsg",name:"Restart"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCyPvbjMjnQBn-6FcxxovSHA",name:"Ð›ÑƒÑ†Ð°Ð¹"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCkrzQDo3U2GmHqqMjqYOuvA",name:"LoVisH Gaming Experience"},
{url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCOw9Jzw3p4XzL5Ub5WglJRQ",name:"ÐÐ»ÐµÐºÑÐµÐ¹ ÐœÐ°ÐºÐ°Ñ€ÐµÐ½ÐºÐ¾Ð²"}
];

const proxies=[
u=>`https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,
u=>`https://cors.isomorphic-git.org/${u}`
];
const proxyFetch=u=>Promise.any(proxies.map(p=>fetch(p(u),{cache:"no-store"})));

const tabsEl=document.getElementById("tabs");
const feedEl=document.getElementById("feed");
const loaderEl=document.getElementById("loader");
const playerWrapper=document.getElementById("playerWrapper");
const videoInfoEl=document.getElementById("videoInfo");

const iframe=document.createElement("iframe");
iframe.allow="autoplay";
iframe.allowFullscreen=true;
iframe.style.width="100%";
iframe.style.height="100%";
iframe.style.border="none";
playerWrapper.appendChild(iframe);

const videoMap=new Map();
let currentTab="Ð’ÑÐµ Ð²Ð¸Ð´ÐµÐ¾";
let currentVideoId=null;
let seekAfterReady=0;

/* ===== YouTube API ===== */
window.onYouTubeIframeAPIReady=()=>{};
const tag=document.createElement("script");
tag.src="https://www.youtube.com/iframe_api";
document.head.appendChild(tag);

let player=null;

function createPlayer(id,start){
    seekAfterReady=start;
    if(player) player.destroy();
    player=new YT.Player(iframe,{
        videoId:id,
        playerVars:{autoplay:1,playsinline:1},
        events:{
            onReady:e=>{
                if(seekAfterReady>0){
                    e.target.seekTo(seekAfterReady,true);
                }
                startTimeTracking();
            }
        }
    });
}

/* ===== Ð²Ñ€ÐµÐ¼Ñ ===== */
let timeTimer=null;
function startTimeTracking(){
    clearInterval(timeTimer);
    timeTimer=setInterval(()=>{
        if(player?.getCurrentTime){
            localStorage.setItem(
                "lastVideoTime",
                Math.floor(player.getCurrentTime())
            );
        }
    },3000);
}

/* ===== init ===== */
init();
function init(){
    const saved=localStorage.getItem("ytVideos");
    if(saved){
        JSON.parse(saved).forEach(v=>{
            v.date=new Date(v.date);
            videoMap.set(v.id,v);
        });
    }
    renderTabs();
    renderVideos();

    feeds.forEach(loadFeed);

    const lastId=localStorage.getItem("lastVideo");
    const t=parseInt(localStorage.getItem("lastVideoTime")||"0",10);
    if(lastId&&videoMap.has(lastId)){
        loadVideo(videoMap.get(lastId),t);
    }
}

/* ===== feeds ===== */
async function loadFeed(feed){
    try{
        const r=await proxyFetch(feed.url);
        const xml=new DOMParser().parseFromString(await r.text(),"text/xml");
        xml.querySelectorAll("entry").forEach(e=>{
            const title=e.querySelector("title")?.textContent||"";
            if(/#shorts/i.test(title))return;
            const id=e.querySelector("yt\\:videoId")?.textContent;
            if(!id||videoMap.has(id))return;
            videoMap.set(id,{
                id,title,channel:feed.name,
                date:new Date(e.querySelector("published")?.textContent)
            });
        });
        saveVideos();
        renderVideos();
    }catch{}
}

function saveVideos(){
    const out=[];
    feeds.forEach(f=>{
        out.push(
            ...[...videoMap.values()]
                .filter(v=>v.channel===f.name)
                .sort((a,b)=>b.date-a.date)
                .slice(0,20)
        );
    });
    localStorage.setItem("ytVideos",JSON.stringify(out));
}

/* ===== UI ===== */
function renderTabs(){
    tabsEl.innerHTML="";
    tabsEl.appendChild(tab("Ð’ÑÐµ Ð²Ð¸Ð´ÐµÐ¾"));
    feeds.forEach(f=>tabsEl.appendChild(tab(f.name)));
}
function tab(name){
    const t=document.createElement("div");
    t.className="tab"+(name===currentTab?" active":"");
    t.textContent=name;
    t.onclick=()=>{
        currentTab=name;
        document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
        t.classList.add("active");
        renderVideos(true);
    };
    return t;
}

let videosLoaded=0,perPage=20,videos=[];
function renderVideos(reset=true){
    if(reset){
        feedEl.innerHTML="";
        videosLoaded=0;
        videos=[...videoMap.values()]
            .filter(v=>currentTab==="Ð’ÑÐµ Ð²Ð¸Ð´ÐµÐ¾"||v.channel===currentTab)
            .sort((a,b)=>b.date-a.date);
    }
    videos.slice(videosLoaded,videosLoaded+perPage).forEach(v=>{
        const d=document.createElement("div");
        d.className="video"+(v.id===currentVideoId?" active":"");
        d.dataset.id=v.id;
        d.innerHTML=`
            <img class="thumb" src="https://i.ytimg.com/vi/${v.id}/hqdefault.jpg">
            <div>
                <div class="title">${v.title}</div>
                <div class="meta">${v.channel} â€¢ ${v.date.toLocaleDateString("ru-RU")}</div>
            </div>`;
        d.onclick=()=>loadVideo(v,0);
        feedEl.appendChild(d);
    });
    videosLoaded+=perPage;
}

function loadVideo(v,start=0){
    currentVideoId=v.id;
    document.querySelectorAll(".video").forEach(x=>{
        x.classList.toggle("active",x.dataset.id===v.id);
    });
    videoInfoEl.textContent=`${v.title} â€” ${v.channel}`;
    localStorage.setItem("lastVideo",v.id);
    createPlayer(v.id,start);
}
</script>
</body>
</html>
